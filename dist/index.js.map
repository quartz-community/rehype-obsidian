{"version":3,"sources":["../src/lib/block-references.ts","../src/lib/checkbox.ts","../src/lib/mermaid-expand.ts","../src/lib/obsidian-uri.ts","../src/lib/tweet-embed.ts","../src/lib/youtube-embed.ts","../src/index.ts"],"sourcesContent":["import type { Element, Parent, Root, Text } from \"hast\";\nimport { visit } from \"unist-util-visit\";\n\nconst blockReferenceRegex = /\\^([-_A-Za-z0-9]+)$/;\nconst inlineTagTypes = new Set([\"p\", \"li\"]);\nconst blockTagTypes = new Set([\"blockquote\"]);\n\ntype VFileData = {\n  blocks: Record<string, Element>;\n  htmlAst?: Root;\n} & Record<string, unknown>;\n\ntype VFileLike = { data?: Record<string, unknown> };\n\nconst isElement = (node: unknown): node is Element =>\n  typeof node === \"object\" &&\n  node !== null &&\n  (node as Element).type === \"element\";\n\nconst isText = (node: unknown): node is Text =>\n  typeof node === \"object\" && node !== null && (node as Text).type === \"text\";\n\nconst isParent = (node: unknown): node is Parent =>\n  typeof node === \"object\" &&\n  node !== null &&\n  Array.isArray((node as Parent).children);\n\nconst ensureFileData = (file: VFileLike): VFileData => {\n  if (!file.data) {\n    file.data = {};\n  }\n\n  const data = file.data as VFileData;\n  if (!data.blocks) {\n    data.blocks = {};\n  }\n\n  return data;\n};\n\nconst applyBlockId = (\n  node: Element,\n  blockId: string,\n  blocks: Record<string, Element>,\n) => {\n  if (!node.properties) {\n    node.properties = {};\n  }\n  node.properties.id = blockId;\n  blocks[blockId] = node;\n};\n\nexport const blockReferences = (tree: Root, file: VFileLike) => {\n  const data = ensureFileData(file);\n  const blocks = data.blocks;\n\n  visit(\n    tree,\n    \"element\",\n    (node: Element, index: number | undefined, parent: Parent | undefined) => {\n      if (!isElement(node)) return;\n\n      if (blockTagTypes.has(node.tagName)) {\n        if (!isParent(parent) || typeof index !== \"number\") return;\n        const siblingIndex = index + 2;\n        const sibling = parent.children[siblingIndex];\n        if (!isElement(sibling) || sibling.tagName !== \"p\") return;\n\n        const firstChild = sibling.children[0];\n        if (!isText(firstChild)) return;\n\n        const match = firstChild.value.match(blockReferenceRegex);\n        if (!match) return;\n\n        const blockId = match[1];\n        parent.children.splice(siblingIndex, 1);\n        applyBlockId(node, blockId, blocks);\n        return;\n      }\n\n      if (!inlineTagTypes.has(node.tagName)) return;\n\n      const children = node.children;\n      if (!children || children.length === 0) return;\n\n      const lastChild = children[children.length - 1];\n      if (!isText(lastChild)) return;\n\n      const match = lastChild.value.match(blockReferenceRegex);\n      if (!match) return;\n\n      const blockId = match[1];\n      const stripped = lastChild.value\n        .replace(blockReferenceRegex, \"\")\n        .trimEnd();\n\n      if (stripped.length === 0) {\n        children.pop();\n\n        if (isParent(parent)) {\n          for (let i = (index ?? 0) - 1; i >= 0; i -= 1) {\n            const sibling = parent.children[i];\n            if (isElement(sibling)) {\n              applyBlockId(sibling, blockId, blocks);\n              return;\n            }\n          }\n        }\n\n        applyBlockId(node, blockId, blocks);\n        return;\n      }\n\n      lastChild.value = stripped;\n      applyBlockId(node, blockId, blocks);\n    },\n  );\n\n  data.htmlAst = tree;\n};\n","import type { Element, Root } from \"hast\";\nimport { visit } from \"unist-util-visit\";\n\nconst isElement = (node: unknown): node is Element =>\n  typeof node === \"object\" &&\n  node !== null &&\n  (node as Element).type === \"element\";\n\nexport const checkbox = (tree: Root) => {\n  visit(tree, \"element\", (node: Element) => {\n    if (!isElement(node) || node.tagName !== \"input\") return;\n    if (!node.properties || node.properties.type !== \"checkbox\") return;\n\n    const properties = node.properties;\n    const checked = properties.checked;\n\n    node.properties = {\n      ...properties,\n      checked,\n      disabled: false,\n      className: \"checkbox-toggle\",\n    };\n  });\n\n  visit(tree, \"element\", (node: Element) => {\n    if (!isElement(node) || node.tagName !== \"li\") return;\n    if (!node.properties) return;\n\n    const className = node.properties.className;\n    const classList = Array.isArray(className)\n      ? className\n      : typeof className === \"string\"\n        ? [className]\n        : [];\n\n    if (!classList.includes(\"task-list-item\")) return;\n\n    const checkboxInput = node.children.find(\n      (child): child is Element =>\n        isElement(child) &&\n        child.tagName === \"input\" &&\n        child.properties?.type === \"checkbox\",\n    );\n\n    if (!checkboxInput) return;\n\n    const checked = Boolean(checkboxInput.properties?.checked);\n    const taskChar =\n      typeof node.properties.dataTaskChar === \"string\"\n        ? node.properties.dataTaskChar\n        : checked\n          ? \"x\"\n          : \"\";\n    const nextClassList =\n      checked && !classList.includes(\"is-checked\")\n        ? [...classList, \"is-checked\"]\n        : classList;\n\n    node.properties = {\n      ...node.properties,\n      className: nextClassList,\n      dataTask: taskChar,\n    };\n    // Clean up the intermediate property â€” only data-task should remain\n    delete node.properties.dataTaskChar;\n  });\n};\n","import type { Element, Parent, Root } from \"hast\";\nimport { visit } from \"unist-util-visit\";\n\nconst isElement = (node: unknown): node is Element =>\n  typeof node === \"object\" &&\n  node !== null &&\n  (node as Element).type === \"element\";\n\nconst isParent = (node: unknown): node is Parent =>\n  typeof node === \"object\" &&\n  node !== null &&\n  Array.isArray((node as Parent).children);\n\nconst hasClassName = (node: Element, className: string) => {\n  const classes = node.properties?.className;\n  if (Array.isArray(classes)) {\n    return classes.includes(className);\n  }\n  if (typeof classes === \"string\") {\n    return classes.split(/\\s+/).includes(className);\n  }\n  return false;\n};\n\nconst expandButton = (): Element => ({\n  type: \"element\",\n  tagName: \"button\",\n  properties: {\n    className: [\"expand-button\"],\n    \"aria-label\": \"Expand mermaid diagram\",\n    \"data-view-component\": true,\n  },\n  children: [\n    {\n      type: \"element\",\n      tagName: \"svg\",\n      properties: {\n        width: 16,\n        height: 16,\n        viewBox: \"0 0 16 16\",\n        fill: \"currentColor\",\n      },\n      children: [\n        {\n          type: \"element\",\n          tagName: \"path\",\n          properties: {\n            d: \"M3.72 3.72a.75.75 0 011.06 1.06L2.56 7h10.88l-2.22-2.22a.75.75 0 011.06-1.06l3.5 3.5a.75.75 0 010 1.06l-3.5 3.5a.75.75 0 11-1.06-1.06l2.22-2.22H2.56l2.22 2.22a.75.75 0 11-1.06 1.06l-3.5-3.5a.75.75 0 010-1.06l3.5-3.5z\",\n          },\n          children: [],\n        },\n      ],\n    },\n  ],\n});\n\nconst mermaidContainer = (): Element => ({\n  type: \"element\",\n  tagName: \"div\",\n  properties: { id: \"mermaid-container\", role: \"dialog\" },\n  children: [\n    {\n      type: \"element\",\n      tagName: \"div\",\n      properties: { id: \"mermaid-space\" },\n      children: [\n        {\n          type: \"element\",\n          tagName: \"div\",\n          properties: { className: [\"mermaid-content\"] },\n          children: [],\n        },\n      ],\n    },\n  ],\n});\n\nexport const mermaidExpand = (tree: Root) => {\n  visit(\n    tree,\n    \"element\",\n    (node: Element, _index: number | undefined, parent: Parent | undefined) => {\n      if (!isElement(node) || node.tagName !== \"code\") return;\n      if (!hasClassName(node, \"mermaid\")) return;\n      if (!isParent(parent)) return;\n\n      parent.children = [expandButton(), node, mermaidContainer()];\n    },\n  );\n};\n","import type { Element, Root } from \"hast\";\nimport { visit } from \"unist-util-visit\";\n\nconst isElement = (node: unknown): node is Element =>\n  typeof node === \"object\" &&\n  node !== null &&\n  (node as Element).type === \"element\";\n\nexport const obsidianUri = (tree: Root) => {\n  visit(tree, \"element\", (node: Element) => {\n    if (!isElement(node) || node.tagName !== \"a\") return;\n    if (!node.properties) return;\n\n    const href = node.properties.href;\n    if (typeof href !== \"string\" || !href.startsWith(\"obsidian://\")) return;\n\n    const className = node.properties.className;\n    const classList = Array.isArray(className)\n      ? className\n      : typeof className === \"string\"\n        ? [className]\n        : [];\n\n    const nextClassList = classList.includes(\"obsidian-uri\")\n      ? classList\n      : [...classList, \"obsidian-uri\"];\n\n    node.properties = {\n      ...node.properties,\n      className: nextClassList,\n      dataObsidianUri: href,\n    };\n  });\n};\n","import type { Element, Parent, Root } from \"hast\";\nimport { visit } from \"unist-util-visit\";\nimport { fromHtml } from \"hast-util-from-html\";\n\nconst tweetRegex =\n  /^https:\\/\\/(twitter\\.com|x\\.com|mobile\\.twitter\\.com)\\/([^/]+)\\/status\\/(\\d+)$/;\n\nconst isElement = (node: unknown): node is Element =>\n  typeof node === \"object\" &&\n  node !== null &&\n  (node as Element).type === \"element\";\n\nconst isParent = (node: unknown): node is Parent =>\n  typeof node === \"object\" &&\n  node !== null &&\n  Array.isArray((node as Parent).children);\n\ninterface TweetNode {\n  index: number;\n  parent: Parent;\n  url: string;\n  user: string;\n}\n\nfunction collectTweetNodes(tree: Root): TweetNode[] {\n  const tweets: TweetNode[] = [];\n\n  visit(\n    tree,\n    \"element\",\n    (node: Element, index: number | undefined, parent: Parent | undefined) => {\n      if (!isElement(node) || node.tagName !== \"img\") return;\n      if (!node.properties) return;\n\n      const src = node.properties.src;\n      if (typeof src !== \"string\") return;\n\n      const match = src.match(tweetRegex);\n      const user = match?.[2];\n      if (!user || !match?.[3]) return;\n\n      if (!isParent(parent) || typeof index !== \"number\") return;\n\n      tweets.push({ index, parent, url: src, user });\n    },\n  );\n\n  return tweets;\n}\n\nasync function fetchOEmbed(\n  url: string,\n): Promise<{ html: string; author_name: string } | null> {\n  const oembedUrl = `https://publish.twitter.com/oembed?url=${encodeURIComponent(url)}&omit_script=true&dnt=true`;\n  try {\n    const response = await fetch(oembedUrl);\n    if (!response.ok) return null;\n    return (await response.json()) as { html: string; author_name: string };\n  } catch {\n    return null;\n  }\n}\n\nfunction oembedHtmlToHast(html: string): Element {\n  const tree = fromHtml(html, { fragment: true });\n  const element = tree.children.find(\n    (child): child is Element => child.type === \"element\",\n  );\n  if (element) return element;\n\n  return {\n    type: \"element\",\n    tagName: \"div\",\n    properties: {},\n    children: tree.children as Element[],\n  };\n}\n\nfunction makeFallbackBlockquote(url: string, user: string): Element {\n  return {\n    type: \"element\",\n    tagName: \"blockquote\",\n    properties: { className: [\"external-embed\", \"twitter\"] },\n    children: [\n      {\n        type: \"element\",\n        tagName: \"a\",\n        properties: { href: url },\n        children: [{ type: \"text\", value: `Tweet by @${user}` }],\n      },\n    ],\n  };\n}\n\nexport const tweetEmbed = async (tree: Root) => {\n  const tweets = collectTweetNodes(tree);\n  if (tweets.length === 0) return;\n\n  const results = await Promise.all(\n    tweets.map(async (t) => ({\n      ...t,\n      oembed: await fetchOEmbed(t.url),\n    })),\n  );\n\n  for (const { index, parent, url, user, oembed } of results) {\n    let replacement: Element;\n\n    if (oembed?.html) {\n      replacement = oembedHtmlToHast(oembed.html);\n      replacement.properties ??= {};\n      const existing = Array.isArray(replacement.properties.className)\n        ? replacement.properties.className\n        : [];\n      replacement.properties.className = [\n        ...existing,\n        \"external-embed\",\n        \"twitter\",\n      ];\n    } else {\n      replacement = makeFallbackBlockquote(url, user);\n    }\n\n    parent.children[index] = replacement;\n  }\n};\n","import type { Element, Parent, Root } from \"hast\";\nimport { visit } from \"unist-util-visit\";\n\nconst youTubeVideoRegex =\n  /^.*(youtu.be\\/|v\\/|u\\/\\w\\/|embed\\/|watch\\?v=|\\&v=)([^#\\&\\?]*).*/;\nconst youTubePlaylistRegex = /[?&]list=([^#?&]*)/;\n\nconst isElement = (node: unknown): node is Element =>\n  typeof node === \"object\" &&\n  node !== null &&\n  (node as Element).type === \"element\";\n\nconst isParent = (node: unknown): node is Parent =>\n  typeof node === \"object\" &&\n  node !== null &&\n  Array.isArray((node as Parent).children);\n\nexport const youTubeEmbed = (tree: Root) => {\n  visit(\n    tree,\n    \"element\",\n    (node: Element, index: number | undefined, parent: Parent | undefined) => {\n      if (!isElement(node) || node.tagName !== \"img\") return;\n      if (!node.properties) return;\n\n      const src = node.properties.src;\n      if (typeof src !== \"string\") return;\n\n      const videoMatch = src.match(youTubeVideoRegex);\n      const playlistMatch = src.match(youTubePlaylistRegex);\n      const playlistId = playlistMatch?.[1];\n      const videoId = videoMatch?.[2];\n\n      const validVideoId =\n        videoId && videoId.length === 11 ? videoId : undefined;\n      if (!validVideoId && !playlistId) return;\n\n      let iframeSrc: string;\n      if (validVideoId && playlistId) {\n        iframeSrc = `https://www.youtube.com/embed/${validVideoId}?list=${playlistId}`;\n      } else if (validVideoId) {\n        iframeSrc = `https://www.youtube.com/embed/${validVideoId}`;\n      } else {\n        iframeSrc = `https://www.youtube.com/embed/videoseries?list=${playlistId}`;\n      }\n\n      const iframe: Element = {\n        type: \"element\",\n        tagName: \"iframe\",\n        properties: {\n          className: [\"external-embed\", \"youtube\"],\n          allow: \"fullscreen\",\n          frameBorder: 0,\n          width: \"600px\",\n          src: iframeSrc,\n        },\n        children: [],\n      };\n\n      if (!isParent(parent) || typeof index !== \"number\") return;\n      parent.children[index] = iframe;\n    },\n  );\n};\n","import type { Root } from \"hast\";\n\nimport { blockReferences } from \"./lib/block-references.js\";\nimport { checkbox } from \"./lib/checkbox.js\";\nimport { mermaidExpand } from \"./lib/mermaid-expand.js\";\nimport { obsidianUri } from \"./lib/obsidian-uri.js\";\nimport { tweetEmbed } from \"./lib/tweet-embed.js\";\nimport { youTubeEmbed } from \"./lib/youtube-embed.js\";\n\nexport interface RehypeObsidianOptions {\n  blockReferences?: boolean;\n  youTubeEmbed?: boolean;\n  tweetEmbed?: boolean;\n  checkbox?: boolean;\n  mermaid?: boolean;\n  obsidianUri?: boolean;\n}\n\nconst defaultOptions: Required<RehypeObsidianOptions> = {\n  blockReferences: true,\n  youTubeEmbed: true,\n  tweetEmbed: true,\n  checkbox: true,\n  mermaid: true,\n  obsidianUri: true,\n};\n\nexport default function rehypeObsidian(userOpts?: RehypeObsidianOptions) {\n  const opts = { ...defaultOptions, ...userOpts };\n  return async (tree: Root, file: { data?: Record<string, unknown> }) => {\n    if (opts.blockReferences) blockReferences(tree, file);\n    if (opts.youTubeEmbed) youTubeEmbed(tree);\n    if (opts.tweetEmbed) await tweetEmbed(tree);\n    if (opts.checkbox) checkbox(tree);\n    if (opts.mermaid) mermaidExpand(tree);\n    if (opts.obsidianUri) obsidianUri(tree);\n  };\n}\n\nexport {\n  blockReferences,\n  youTubeEmbed,\n  tweetEmbed,\n  checkbox,\n  mermaidExpand,\n  obsidianUri,\n};\n"],"mappings":"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","names":["match","blockId","visit","isElement","visit","isElement","isParent","visit","isElement","visit","isElement","isParent","visit","isElement","isParent"]}